const coverColor=()=>{const e=document.getElementById("post-cover")?.src;e?localColor(e):(document.documentElement.style.setProperty("--efu-main","var(--efu-theme)"),document.documentElement.style.setProperty("--efu-main-op","var(--efu-theme-op)"),document.documentElement.style.setProperty("--efu-main-op-deep","var(--efu-theme-op-deep)"),document.documentElement.style.setProperty("--efu-main-none","var(--efu-theme-none)"),initThemeColor())},localColor=e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=function(){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0);const o=n.getImageData(0,0,t.width,t.height).data,{r:r,g:l,b:a}=calculateRGB(o);let m=rgbToHex(r,l,a);"light"===getContrastYIQ(m)&&(m=LightenDarkenColor(m,-50)),setThemeColors(m,r,l,a)},t.onerror=function(){console.error("图片加载失败")},t.src=e};function calculateRGB(e){let t=0,n=0,o=0;for(let r=0;r<e.length;r+=20)t+=e[r],n+=e[r+1],o+=e[r+2];return t=Math.floor(t/(e.length/4/5)),n=Math.floor(n/(e.length/4/5)),o=Math.floor(o/(e.length/4/5)),{r:t,g:n,b:o}}function rgbToHex(e,t,n){return"#"+[e,t,n].map((e=>e.toString(16).padStart(2,"0"))).join("")}function LightenDarkenColor(e,t){let n=!1;"#"===e[0]&&(e=e.slice(1),n=!0);const o=parseInt(e,16),r=Math.min(255,Math.max(0,(o>>16)+t)),l=Math.min(255,Math.max(0,(o>>8&255)+t));return`${n?"#":""}${(Math.min(255,Math.max(0,(255&o)+t))|l<<8|r<<16).toString(16).padStart(6,"0")}`}function getContrastYIQ(e){let t=colorRgb(e).match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),n=299*t[1]+587*t[2]+114*t[3];return n/=255e3,n>=.5?"light":"dark"}function colorRgb(e){if(!e||"string"!=typeof e)return e;const t=e.toLowerCase();let n="";if(t&&(/^#([0-9a-fA-f]{3})$/.test(t)||/^#([0-9a-fA-f]{6})$/.test(t))){n=4===t.length?t.replace(/^#(.)/g,"#$1$1"):t;const e=n.slice(1).match(/.{2}/g).map((e=>parseInt(e,16)));return`rgb(${e[0]}, ${e[1]}, ${e[2]})`}return t}function setThemeColors(e,t=null,n=null,o=null){if(e){if(document.documentElement.style.setProperty("--efu-main",e),document.documentElement.style.setProperty("--efu-main-op",e+"23"),document.documentElement.style.setProperty("--efu-main-op-deep",e+"dd"),document.documentElement.style.setProperty("--efu-main-none",e+"00"),t&&n&&o){if(Math.round((299*parseInt(t)+587*parseInt(n)+114*parseInt(o))/1e3)<125){let e=document.getElementsByClassName("card-content");for(let t=0;t<e.length;t++)e[t].style.setProperty("--efu-card-bg","var(--efu-white)");let t=document.getElementsByClassName("author-info__sayhi");for(let e=0;e<t.length;e++)t[e].style.setProperty("background","var(--efu-white-op)"),t[e].style.setProperty("color","var(--efu-white)")}}document.getElementById("coverdiv").classList.add("loaded"),initThemeColor()}else document.documentElement.style.setProperty("--efu-main","var(--efu-theme)"),document.documentElement.style.setProperty("--efu-main-op","var(--efu-theme-op)"),document.documentElement.style.setProperty("--efu-main-op-deep","var(--efu-theme-op-deep)"),document.documentElement.style.setProperty("--efu-main-none","var(--efu-theme-none)"),initThemeColor()}