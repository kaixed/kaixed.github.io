function initializeCommentBarrage(e){if(e===[])return;let r=window.currentBarrage;r&&r.destroy();window.currentBarrage=new class{constructor(){this.config={barrageTimer:[],barrageList:[],barrageIndex:0,dom:document.querySelector(".comment-barrage"),maxBarrage:1,barrageTime:5e3},this.hoverOnCommentBarrage=!1,this.init()}filterAndFlatten(e){return e.flatMap((e=>e.replies?[e,...this.filterAndFlatten(e.replies)]:[e]))}sanitizeContent(e){return e.replace(/(<([^>]+)>)/gi,"").trim()}createBarrageItem(e){const r=this.sanitizeContent(e.content);if(!r)return!1;const a=document.createElement("div");return a.className="comment-barrage-item",a.innerHTML=`<div class="barrageHead"><a class="barrageTitle" href="javascript:sco.scrollTo('post-comment')">${GLOBAL_CONFIG.lang.barrage.title}</a><div class="barrageNick">${e.nick}</div><img class="barrageAvatar" src="${GLOBAL_CONFIG.comment.avatar}/avatar/${e.mailMd5}"/><a class="comment-barrage-close" href="javascript:sco.switchCommentBarrage();"><i class="solitude st-close-fill"></i></a></div><a class="barrageContent" href="${e.id?`javascript:sco.scrollTo('${e.id}')`:"javascript:sco.scrollTo('post-comment')"}">${r}</a>`,this.config.dom.appendChild(a),this.config.barrageTimer.push(a),!0}removeBarrageItem(e){e.classList.add("out"),setTimeout((()=>this.config.dom.removeChild(e)),1e3)}manageBarrage(){if(this.config.barrageList.length&&!this.hoverOnCommentBarrage){if(!this.createBarrageItem(this.config.barrageList[this.config.barrageIndex]))return this.config.barrageIndex=(this.config.barrageIndex+1)%this.config.barrageList.length,this.manageBarrage();this.config.barrageIndex=(this.config.barrageIndex+1)%this.config.barrageList.length}this.config.barrageTimer.length>Math.min(this.config.maxBarrage,this.config.barrageList.length)&&!this.hoverOnCommentBarrage&&this.removeBarrageItem(this.config.barrageTimer.shift())}async initBarrage(){const r=utils.saveToLocal.get("commentBarrageSwitch");this.config.dom.style.display=r?"flex":"none",this.config.barrageList=this.filterAndFlatten(e),this.config.dom.innerHTML="",clearInterval(this.commentInterval),this.commentInterval=setInterval((()=>this.manageBarrage()),this.config.barrageTime)}async init(){await this.initBarrage(),this.config.dom.addEventListener("mouseover",(()=>this.hoverOnCommentBarrage=!0)),this.config.dom.addEventListener("mouseout",(()=>this.hoverOnCommentBarrage=!1))}destroy(){clearInterval(this.commentInterval),this.config.dom.removeEventListener("mouseover",(()=>this.hoverOnCommentBarrage=!0)),this.config.dom.removeEventListener("mouseout",(()=>this.hoverOnCommentBarrage=!1)),this.config.dom.innerHTML=""}}}